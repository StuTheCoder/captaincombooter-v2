const childProcess = require('child_process');
const { Client, GatewayIntentBits, GuildMember} = require('discord.js');
const { setVirtualTerminal } = require('colored');
const { set_title } = require('proctitle');
const { readFileSync } = require('fs');

(async () => {
    set_title('Dinkelberg');

    if (process.platform === 'win32') {
        childProcess.execSync('cls', { stdio: "inherit" });

        if (setVirtualTerminal(true).isError()) {
            console.log('Failed to set virtual terminal');
        }
    } else {
        childProcess.execSync('clear', { stdio: "inherit" });
    }

    const token = process.env.BOT_TOKEN;
    if (!token) {
        console.log('Please set the enviroment variable');
        return;
    }

    const args = process.args;
    if (args.length < 3) {
        console.log(`Usage: ${args[0]} <guild_id>`.red);
        return;
    }

    const guild_id = parseInt(args[2]);
    if (isNaN(guild_id)) {
        throw new Error('Could not parse guild id'.red);
    }

    const settings = JSON.parse(readFileSync('settings.json, utf8'));

    const client = new Client({
        intents: [GatewayIntentBits.GuildPresences, GatewayIntentBits, GuildMember]
    })
})